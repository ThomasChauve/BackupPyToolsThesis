import math
import numpy as np
import matplotlib.pyplot as plt
import matplotlib.ticker as ticker
import matplotlib.cm as cm
from numpy import angle

def fmt(x, pos):
    '''
    function to format tick in the figure as x*10^y
    '''
    a, b = '{:.2e}'.format(x).split('e')
    b = int(b)
    return r'${} \times 10^{{{}}}$'.format(a, b)


def plotpdf_craft(ori,colors,colorbarcenter=True):
    '''
    Plot on the pole figure at each phi1,phi given, the associated color value.
    
    :param ori: [phi1,phi,phi2] Bunge Euler angle
    :type ori: array
    :param color: array of value
    :type color: array    
    :param colorbarcenter: do you want center the colorbar around 0
    :type colorbarcenter: bool
    '''
    # compute a circle
    omega = np.linspace(0, 2*math.pi, 60)
    x_circle = 1.5*np.cos(omega)
    y_circle = 1.5*np.sin(omega)
    
    img=plt.plot(x_circle, y_circle,'k', linewidth=3)
    # draw a cross for x and y direction
    img=plt.plot([1.5, 0],[0, 1.5],'+k',markersize=12)
    # write axis
    img=plt.text(1.6, -0.04, r'X')
    img=plt.text(-0.04, 1.6, r'Y')
    img=plt.text(-1.4, 1.4, r'(0001)')

    # compute azimuth and colatitude
    azi=np.mod(ori[:,0]-math.pi/2,2*math.pi)
    col=ori[:,1]

    # compute [xc,yc,zc] the coordinate of the c-axis
    xc = np.multiply(np.cos(azi),np.sin(col))
    yc = np.multiply(np.sin(azi),np.sin(col))
    zc = np.cos(col)
    
    #compute theta and phi
    theta=np.arccos(zc)
    phi=np.arctan2(yc, xc)
    # caculate coordinate for the pole figure
    xx = np.multiply(2*np.sin(theta/2),np.cos(phi))
    yy = np.multiply(2*np.sin(theta/2),np.sin(phi))

    img=plt.scatter(xx,yy,c=colors,s=500,cmap=cm.seismic)
    
    if colorbarcenter:
        zcolor=np.max(np.abs([np.min(colors),np.max(colors)]))
        plt.clim(-zcolor, zcolor)
    
    img=plt.colorbar(orientation='horizontal',aspect=10,format=ticker.FuncFormatter(fmt))
    img=plt.axis('off')
    img=plt.axis('equal')
    
    return img
    
def ori():
    '''
    Euler angle
    '''
    ori=np.array([[ 2.48522472,  1.29841292,  0.17734241],
                   [ 0.        ,  0.55357438,  3.55885053],
                   [ 3.83645844,  1.46054375,  3.12026119],
                   [ 3.68175888,  1.1359787 ,  2.65973949],
                   [ 3.84958339,  1.03579128,  0.26187092],
                   [ 4.00354433,  1.1514591 ,  3.58265758],
                   [ 3.95859146,  1.32535124,  3.3624239 ],
                   [ 1.55445445,  0.72680277,  1.6423012 ],
                   [ 1.70059657,  0.87220454,  2.47730231],
                   [ 1.32407546,  0.61916173,  3.14858246],
                   [ 1.49991095,  0.46428686,  1.82141209],
                   [ 1.84410477,  0.53592652,  2.7864747 ],
                   [ 1.01722193,  0.62831855,  1.35913897],
                   [ 1.82553685,  0.71459347,  2.79745746],
                   [ 1.90977561,  0.94252712,  0.82640833],
                   [ 1.76681805,  1.07466984,  2.0282352 ],
                   [ 2.05387831,  0.80132115,  5.16724062],
                   [ 2.23843861,  0.91378361,  3.35281277],
                   [ 2.16264629,  1.08113217,  2.70571399],
                   [ 1.96519244,  1.11514163,  0.83979535],
                   [ 0.30999783,  1.41055405,  1.65616369],
                   [ 0.49126643,  1.40289116,  2.98480535],
                   [ 0.13412207,  1.45190954,  0.34332785],
                   [ 5.26596355,  0.62831855,  3.05163765],
                   [ 0.07221446,  1.2834723 ,  4.7524991 ],
                   [ 0.22000736,  1.17074418,  1.72730362],
                   [ 0.3915979 ,  1.25001359,  5.91372013],
                   [ 4.5442729 ,  1.26489961,  1.13695383],
                   [ 4.52247047,  1.08703887,  5.11671925],
                   [ 4.59243488,  1.4376266 ,  5.68640423],
                   [ 4.42435503,  1.5015471 ,  0.95832092],
                   [ 4.30351019,  1.36841261,  5.31486511],
                   [ 4.36730242,  1.2001729 ,  6.14184666],
                   [ 0.0145291 ,  0.84411228,  5.66253424],
                   [ 5.91832161,  1.04719758,  3.61215758],
                   [ 6.13027668,  0.70854884,  5.01822567],
                   [ 0.17231968,  0.97305274,  5.67156887],
                   [ 0.03545478,  1.10776675,  2.31948471],
                   [ 6.12423134,  1.05677307,  4.94149733],
                   [ 6.06795454,  0.8838712 ,  1.17761433],
                   [ 4.37010098,  0.96407616,  2.26635337],
                   [ 4.56925821,  0.88098085,  5.95535326],
                   [ 4.21603918,  1.08555341,  5.56585264],
                   [ 4.04986668,  0.97708815,  2.70138144],
                   [ 4.11193466,  0.80467683,  3.18463683],
                   [ 4.15881443,  1.2566371 ,  4.52568293],
                   [ 4.36153126,  0.78520477,  2.19432521],
                   [ 0.45044371,  0.68587482,  1.27284467],
                   [ 0.17120224,  0.70211852,  0.72343731],
                   [ 0.73454666,  0.6796087 ,  0.79225504],
                   [ 0.7390517 ,  0.85857284,  4.71245432],
                   [ 0.53097975,  0.9340812 ,  2.96575665],
                   [ 0.33093569,  0.84477425,  0.58085847],
                   [ 4.69604731,  0.72680277,  5.4083004 ],
                   [ 4.84218931,  0.87220454,  1.7968688 ],
                   [ 4.4656682 ,  0.61916173,  5.99688625],
                   [ 5.26596355,  1.2566371 ,  2.80299711],
                   [ 4.64150381,  0.46428686,  0.73207068],
                   [ 4.98569727,  0.53592652,  1.68282127],
                   [ 4.96712971,  0.71459347,  4.31211424],
                   [ 1.75832701,  1.25349176,  0.85749555],
                   [ 1.57804441,  1.19609642,  6.19591284],
                   [ 1.94104016,  1.29271281,  3.37768602],
                   [ 1.91390884,  1.46971548,  3.13341951],
                   [ 1.73836434,  1.50757992,  1.08845651],
                   [ 1.61989462,  1.37243593,  4.70856237],
                   [ 0.48722568,  0.34777439,  2.72909689],
                   [ 2.12437057,  1.2566371 ,  5.87576485],
                   [ 0.34494287,  0.51693851,  4.92273331],
                   [ 0.72909153,  0.17899123,  4.31098175],
                   [ 1.33131444,  0.29601631,  3.98550415],
                   [ 1.09434903,  0.45368126,  4.49167538],
                   [ 0.71630275,  0.50089985,  1.54857504],
                   [ 5.58043003,  1.4715178 ,  2.27816868],
                   [ 5.23186159,  1.43252552,  5.91287518],
                   [ 5.4107852 ,  1.40490198,  4.81711197],
                   [ 0.63499284,  1.29143834,  3.73479843],
                   [ 0.69486588,  1.46054375,  0.5482257 ],
                   [ 1.57079637,  0.        ,  4.65821934],
                   [ 0.5401662 ,  1.1359787 ,  1.39617789],
                   [ 0.70799071,  1.03579128,  5.51578283],
                   [ 0.86195189,  1.1514591 ,  0.4909479 ],
                   [ 0.81699878,  1.32535124,  1.27710378],
                   [ 3.98565245,  1.55993772,  6.21815825],
                   [ 4.10768557,  1.42858052,  4.328228  ],
                   [ 4.24910831,  1.53907609,  5.86997175],
                   [ 5.62681723,  1.29841292,  3.22891521],
                   [ 5.77892113,  1.39866149,  3.28919053],
                   [ 5.45300961,  1.23062682,  0.96568769],
                   [ 2.77672887,  1.04719758,  4.82064724],
                   [ 5.50675154,  1.05842602,  6.00784969],
                   [ 5.71232271,  1.05602109,  3.90821409],
                   [ 5.79520369,  1.21850765,  0.71885723],
                   [ 5.9605999 ,  1.39273012,  0.91955966],
                   [ 5.90847635,  1.56405115,  4.74153662],
                   [ 5.986022  ,  1.21542132,  3.08533239],
                   [ 6.17589474,  1.22950661,  1.11626911],
                   [ 6.2190733 ,  1.40356624,  3.5565114 ],
                   [ 6.08459187,  1.52266157,  0.45619333],
                   [ 2.8190074 ,  1.39273012,  0.05231617],
                   [ 0.36486384,  1.04719758,  4.08548737],
                   [ 2.76688385,  1.56405115,  2.73710704],
                   [ 2.84442925,  1.21542132,  3.3454504 ],
                   [ 3.034302  ,  1.22950661,  1.95405602],
                   [ 3.07748055,  1.40356624,  1.40491354],
                   [ 2.94299912,  1.52266157,  1.84504473],
                   [ 0.84405988,  1.55993772,  1.95403111],
                   [ 0.96609271,  1.42858052,  4.7486968 ],
                   [ 1.10751545,  1.53907609,  1.57384121],
                   [ 2.63732862,  1.39866149,  2.94072151],
                   [ 3.50645638,  1.04719758,  0.27031317],
                   [ 1.01722193,  1.2566371 ,  2.1530745 ],
                   [ 2.12437057,  0.62831855,  2.0722568 ],
                   [ 4.15881443,  0.62831855,  1.25847387],
                   [ 3.62881827,  0.34777439,  3.47319865],
                   [ 3.48653555,  0.51693851,  0.79199702],
                   [ 3.87068415,  0.17899123,  1.75975406],
                   [ 4.47290707,  0.29601631,  5.01654387],
                   [ 4.23594189,  0.45368126,  6.14086151],
                   [ 3.85789537,  0.50089985,  6.23198938],
                   [ 2.31141686,  1.23062682,  1.91158581],
                   [ 2.43883753,  1.4715178 ,  2.11060286],
                   [ 2.09026909,  1.43252552,  5.69968748],
                   [ 2.2691927 ,  1.40490198,  1.75893664],
                   [ 3.59203649,  0.68587482,  2.81209636],
                   [ 3.31279492,  0.70211852,  2.64317894],
                   [ 3.8761394 ,  0.6796087 ,  2.13303947],
                   [ 3.88064432,  0.85857284,  1.43086243],
                   [ 3.67257237,  0.9340812 ,  2.52329803],
                   [ 3.47252846,  0.84477425,  2.56211877],
                   [ 1.22850823,  0.96407616,  2.42155504],
                   [ 2.3651588 ,  1.05842602,  5.21726465],
                   [ 1.42766547,  0.88098085,  2.22912788],
                   [ 1.07444656,  1.08555341,  0.07238064],
                   [ 0.90827388,  0.97708815,  1.14398539],
                   [ 0.97034216,  0.80467683,  4.54248428],
                   [ 1.2199384 ,  0.78520477,  2.63901973],
                   [ 4.89991951,  1.25349176,  2.01815891],
                   [ 4.71963692,  1.19609642,  3.02716041],
                   [ 5.08263302,  1.29271281,  2.39476967],
                   [ 5.05550146,  1.46971548,  3.35833192],
                   [ 4.87995672,  1.50757992,  5.12824345],
                   [ 2.57072997,  1.05602109,  1.16195166],
                   [ 4.76148748,  1.37243593,  1.59220529],
                   [ 3.15612173,  0.84411228,  4.90154219],
                   [ 2.9886837 ,  0.70854884,  2.71521854],
                   [ 3.31391239,  0.97305274,  2.64733958],
                   [ 3.17704749,  1.10776675,  3.2457478 ],
                   [ 2.98263884,  1.05677307,  2.787498  ],
                   [ 2.9263618 ,  0.8838712 ,  4.30329943],
                   [ 5.85392332,  0.70284408,  1.54418504],
                   [ 5.93778229,  0.53042692,  4.81929541],
                   [ 5.83603573,  0.88138658,  1.6946013 ],
                   [ 2.65361094,  1.21850765,  0.16683969],
                   [ 5.60680819,  0.89975291,  3.5672698 ],
                   [ 5.4749279 ,  0.74897367,  2.38201022],
                   [ 5.61821032,  0.59341723,  3.47886753],
                   [ 1.40268052,  1.26489961,  2.73247576],
                   [ 1.38087761,  1.08703887,  1.07596338],
                   [ 1.45084238,  1.4376266 ,  3.78494787],
                   [ 1.28276229,  1.5015471 ,  5.49914837],
                   [ 1.16191745,  1.36841261,  3.89114404],
                   [ 1.22571003,  1.2001729 ,  3.34287453],
                   [ 2.71233058,  0.70284408,  3.82072568],
                   [ 3.14159274,  0.55357438,  6.02621841],
                   [ 2.79618979,  0.53042692,  6.06820822],
                   [ 2.69444323,  0.88138658,  1.83055234],
                   [ 2.46521544,  0.89975291,  2.23324275],
                   [ 2.3333354 ,  0.74897367,  1.82350838],
                   [ 2.47661734,  0.59341723,  4.66134453],
                   [ 5.76685333,  0.36695907,  4.00713062],
                   [ 6.26475763,  0.37476674,  1.78563678],
                   [ 5.38036346,  0.45915887,  5.93147707],
                   [ 5.0052104 ,  0.35712627,  0.20290478],
                   [ 5.07512999,  0.17899123,  3.79200077],
                   [ 1.57079637,  1.01722193,  5.97776318],
                   [ 6.04370356,  0.20426889,  2.94947863],
                   [ 2.62526083,  0.36695907,  1.32373238],
                   [ 3.12316513,  0.37476674,  5.08241606],
                   [ 2.23877096,  0.45915887,  3.69686747],
                   [ 1.86361754,  0.35712627,  1.93711817],
                   [ 1.93353748,  0.17899123,  0.98554003],
                   [ 2.90211082,  0.20426889,  3.84935212],
                   [ 3.45159054,  1.41055405,  0.97673529],
                   [ 3.63285899,  1.40289116,  1.96544206],
                   [ 3.27571464,  1.45190954,  3.63974929],
                   [ 4.71238899,  1.01722193,  4.15853262],
                   [ 3.21380711,  1.2834723 ,  4.27066326],
                   [ 3.36159992,  1.17074418,  4.0006876 ],
                   [ 3.53319049,  1.25001359,  3.25187206],
                   [ 5.05136824,  0.94252712,  4.87376881],
                   [ 4.90841055,  1.07466984,  5.12019205],
                   [ 5.19547081,  0.80132115,  6.00839233],
                   [ 5.38003111,  0.91378361,  3.53660107],
                   [ 5.3042388 ,  1.08113217,  2.52330995],
                   [ 5.1067853 ,  1.11514163,  0.85889417],
                   [ 3.77658558,  1.29143834,  1.17392051]])
    return ori

def schmid(sigma,ori):
    '''
    Compute schmid value
    '''
    # compute azimuth and colatitude
    azi=np.mod(ori[:,0]-math.pi/2,2*math.pi)
    col=ori[:,1]

    # compute [xc,yc,zc] the coordinate of the c-axis
    xc = np.multiply(np.cos(azi),np.sin(col))
    yc = np.multiply(np.sin(azi),np.sin(col))
    zc = np.cos(col)
    schmid=np.zeros(len(xc))
    for i in list(range(len(xc))):
        ca=np.matrix([[xc[i]],[yc[i]],[zc[i]]])
        schmid[i]=math.pow(math.pow(np.linalg.norm(sigma*ca),2)-math.pow(np.transpose(ca)*sigma*ca,2),0.5)
        
    return schmid